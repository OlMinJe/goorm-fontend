<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>회원가입_2-1</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      main {
        padding: 30px;
      }

      .form-container {
        margin: 0 auto;
        padding: 20px;
        width: 350px;
        min-width: 350px;
        border: 1px solid #f0f0f0;
      }

      .form-container fieldset {
        margin-bottom: 10px;
        border: none;
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .form-container legend {
        margin-bottom: 10px;
      }

      .form-container input,
      .form-container button,
      .form-container #error {
        padding: 5px;
        width: 100%;
        border: 1px solid #bebebe;
      }

      .form-container #error {
        background-color: rgb(239, 239, 239);
        display: none;
      }

      .form-container #user-count {
        min-height: 20px;
        color: #8c8c98;
        text-align: center;
        font-size: 1rem;
        font-weight: 700;
      }
    </style>
  </head>
  <body>
    <main>
      <div class="form-container">
        <form>
          <fieldset>
            <legend>👤 사용자 생성</legend>
            <input type="text" id="userName" placeholder="이름" />
            <input type="password" id="userPassword" placeholder="비밀번호" />
            <button type="button" onclick="createUser()">사용자 만들기</button>
          </fieldset>

          <fieldset>
            <legend>🔐 비밀번호 확인</legend>
            <input type="password" id="confirm-password" placeholder="비밀번호 확인" />
            <button type="button" onclick="checkPassword()">비밀번호 확인</button>
          </fieldset>

          <fieldset>
            <legend>📊 전체 사용자 수 확인</legend>
            <p id="user-count">현재 사용자 수</p>
            <button type="button" onclick="showUserCount()">현재 생성된 사용자 수 보기</button>
          </fieldset>

          <p id="error"></p>
        </form>
      </div>
    </main>

    <script>
      const ERRORS = {
        NO_NAME: '❌ 이름을 입력해 주세요.',
        NO_PASSWORD: '❌ 비밀번호를 입력해 주세요.',
        NO_NAME_AND_PASSWORD: '❌ 이름과 비밀번호를 모두 입력하세요.',
        NO_CURRENT_USER: '❌ 먼저 사용자를 생성하세요.',
        NO_INPUT_PASSWORD: '❌ 비밀번호를 입력해주세요.',
        PASSWORD_VALIDITY: '❌ 비밀번호는 6자 이상이어야 합니다.',
        PASSWORD_MISMATCH: '❌ 비밀번호가 틀립니다.',
      };

      class User {
        static count = 0;
        static currentUser = null; // getter를 통해 가공된 유저 정보 저장용

        #password = '';
        _name = '';

        constructor(name, password) {
          this.name = name;
          this.#password = password;
          User.count++;
        }

        set name(value) {
          if (value.length < 2) throw new Error('이름은 두 글자 이상이어야 합니다.');
          this._name = value; // this.name 이면 setter를 다시 호출해서 무한루프가 발생할 수 있음
        }

        get name() {
          return this._name.toUpperCase();
        }

        // static이 아닌 이유 - #password라서 클래스 전체(static)에서는 접근할 수 없음
        checkPassword(inputPassword) {
          return this.#password === inputPassword;
        }

        static getCount() {
          return this.count;
        }
      }

      // ========== 메시지 출력 함수 ==========
      function showMessage(msg, isError = true) {
        const msgBox = document.getElementById('error');
        msgBox.textContent = msg;
        msgBox.style.color = isError ? 'red' : 'green';
        msgBox.style.display = msg ? 'block' : 'none';
      }

      // ========== 유저 생성 함수 ==========
      function createUser() {
        const name = document.getElementById('userName').value.trim();
        const password = document.getElementById('userPassword').value;

        if (!name) return showMessage(ERRORS.NO_NAME);
        if (!password) return showMessage(ERRORS.NO_PASSWORD);
        if (!name && !password) return showMessage(ERRORS.NO_NAME_AND_PASSWORD);
        if (password.length < 6) return showMessage(ERRORS.PASSWORD_VALIDITY);

        try {
          User.currentUser = new User(name, password);
          showMessage(`✅ 사용자 ${User.currentUser.name} 생성 완료!`, false);
        } catch (err) {
          showMessage(`❌ ${err.message}`);
        }
      }

      // ========== 비밀번호 확인 함수 ==========
      function checkPassword() {
        const inputPw = document.getElementById('confirm-password').value;

        if (!inputPw) return showMessage(ERRORS.NO_INPUT_PASSWORD);
        if (!User.currentUser) return showMessage(ERRORS.NO_CURRENT_USER);

        const isMatch = User.currentUser.checkPassword(inputPw);
        showMessage(isMatch ? '✅ 비밀번호가 일치합니다!' : ERRORS.PASSWORD_MISMATCH, !isMatch);
      }

      // ========== 생성된 유저 확인 함수 ==========
      function showUserCount() {
        const count = User.getCount();
        document.getElementById('user-count').textContent = `현재 사용자 수: ${count}명`;
      }
    </script>
  </body>
</html>
