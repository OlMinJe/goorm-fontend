<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <style>
      .toast-container {
        position: fixed;
        z-index: 9999;
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .toast-container.top-right {
        top: 20px;
        right: 20px;
        align-items: flex-end;
      }

      .toast-container.bottom-right {
        bottom: 20px;
        right: 20px;
        align-items: flex-end;
      }

      .toast-container.top-left {
        top: 20px;
        left: 20px;
        align-items: flex-start;
      }

      .toast-container.bottom-left {
        bottom: 20px;
        left: 20px;
        align-items: flex-start;
      }

      .toast-container.center {
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        align-items: center;
      }

      .toast {
        display: flex;
        align-items: center;
        gap: 10px;
        min-width: 200px;
        max-width: 300px;
        background-color: #444;
        color: white;
        padding: 12px 18px;
        border-radius: 6px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        opacity: 0;
        transform: translateY(-20px);
        transition: all 0.3s ease;
        position: relative;
        font-family: sans-serif;
      }

      .toast.show {
        opacity: 1;
        transform: translateY(0);
      }

      .toast .icon {
        font-size: 18px;
      }

      .toast .close {
        position: absolute;
        top: 8px;
        right: 10px;
        cursor: pointer;
        font-weight: bold;
      }

      /* 상태별 색상 */
      .toast.success {
        background-color: #2ecc71;
      }

      .toast.error {
        background-color: #e74c3c;
      }

      .toast.warning {
        background-color: #f39c12;
      }

      .toast.info {
        background-color: #3498db;
      }
    </style>

    <title>Toast</title>
  </head>

  <body>
    <button onclick="new Toast('저장 완료!', { type: 'success', duration: 1000, position:'top-right' })">
      토스트 띄우기
    </button>
  </body>
  <script>
    const ICON_TYPES = { success: '✅', error: '❌', warning: '⚠️', info: 'ℹ️' };
    const DEFAULTS = { type: 'info', duration: 1000, position: 'top-right' };

    const VALID_TYPES = ['success', 'error', 'warning', 'info'];
    const VALID_POSITIONS = ['top-left', 'top-right', 'bottom-left', 'bottom-right', 'center'];

    const validateOrDefault = (value, validList, fallback) => (validList.includes(value) ? value : fallback);

    function Toast(message, option = {}) {
      const settings = { ...DEFAULTS, ...option };

      this.message = message;
      this.type = validateOrDefault(settings.type, VALID_TYPES, DEFAULTS.type);
      this.duration = settings.duration;
      this.position = validateOrDefault(settings.position, VALID_POSITIONS, DEFAULTS.position);

      this._create();
    }

    // 메시지, { 타입, 위치, 시간 }
    Toast.prototype._create = function () {
      // 1. 위치별 컨테이너 확인 또는 생성
      let container = document.querySelector(`.toast-container.${this.position}`);
      if (!container) {
        container = document.createElement('div');
        container.classList.add('toast-container', this.position);
        document.body.appendChild(container);
      }

      // 2. 각각의 알림 생성 후 추가
      const newToast = document.createElement('div');
      newToast.className = `toast ${this.type}`;
      newToast.innerHTML = `<span class="icon">${ICON_TYPES[this.type]}</span>
                            <span class="message">${this.message}</span>
                            <span class="close">&times;</span>`;
      container.appendChild(newToast);

      /**setTimeout 대신 requestAnimationFrame을 사용하는가
       * - 화면이 부드럽게 에니메이션되고, 깜빡임 없이 잘 보이게 하기 위함!
       *
       * requestAnimationFrame란?
       * - 브라우저가 다음 화면을 그리기 직전에 실행해줘!의 메서드..랄까..
       *
       * setTimeout을 사용하면 실행하는 시점과 브라우저 화면에 그려지는 시점이 맞지 않을 수도 있음.
       * 여기에서 requestAnimationFrame을 사용하면 화면 전환을 부드럽게 유도할 수 있음.
       *
       * 토스트 알림이 화면에 추가됨 => CSS로 opacity: 0 > 1 트랜지션이 있음
       * - 이 때 classList.add('show')를 바로 실행하면 브라우저가 "어? opacity가 바로 1이네"하고 트랜지션 생략함
       * - 그래서 requestAnimationFrame으로 "다음 그리기 타이밍에 클래스 추가해줘!" 라고 하면
       * - 브라우저가 그 사이에 opacity: 0 상태를 기억했다가, opacity: 1로 바뀌는 걸 감지해서 애니메이션을 제대로 실행함
       *
       * 즉, requestAnimationFrame은 브라우저가 화면을 그릴 준비가 되었을 때 실행하니까,
       * 애니메이션이 자연스럽게 시작되도록 도와주는 도구
       */
      requestAnimationFrame(() => newToast.classList.add('show'));

      // 닫기 버튼 클릭 이벤트
      newToast.querySelector('.close').addEventListener('click', () => this._remove(newToast));

      // setTimeout으로 자동 제거
      setTimeout(() => this._remove(newToast), this.duration);
    };

    // 4. 닫기 버튼 클릭 시 수동 제거
    Toast.prototype._remove = function (toastElement) {
      if (!toastElement) return;

      toastElement.classList.remove('show');

      setTimeout(() => {
        const container = toastElement.parentElement;
        toastElement.remove();
        if (container && container.children.length === 0) container.remove();
      }, this.duration);
    };
  </script>
</html>
