<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>⚾️ 야구 일정표</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        padding: 40px;
      }
      .font-size-xs {
        font-weight: 400;
        font-size: 0.7rem;
        color: #888787;
      }
      .font-size-sm {
        font-weight: 400;
        font-size: 0.8rem;
        color: #888787;
      }
      .font-size-lg {
        font-weight: 700;
        font-size: 0.8rem;
        color: #000;
      }
      .text-center {
        text-align: center;
      }

      /*  */
      h1 {
        margin-bottom: 20px;
      }
      main {
        margin: 0 auto;
        max-width: 1000px;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        color: #888787;
        font-size: 0.8rem;
        text-align: left;
      }
      th {
        background-color: #f5f5f5;
        font-weight: 400;
      }
      th,
      td {
        padding: 5px 10px;
      }
      tbody {
        border-top: 1px solid #dbdbdb;
      }
      tbody td[rowspan='5'] {
        border-right: 1px solid #dbdbdb;
      }
      .today-game {
        border: 1px solid blue;
        background-color: rgba(215 230 242 / 40%);
      }
      .team-box {
        display: flex;
        align-items: center;
        gap: 6px;
      }
      .team-box img {
        width: 24px;
        height: 24px;
        object-fit: contain;
      }
      .team-box {
        justify-content: center;
      }
      .game-score {
        display: flex;
        align-items: center;
        justify-content: space-around;
        font-weight: 700;
        font-size: 1rem;
        color: #000;
      }

      .win {
        color: red;
      }

      .btn-highlight,
      .btn-messsage {
        padding: 3px 5px;
      }

      .btn-highlight {
        color: blue;
        border: 1px solid blue;
        background-color: #fff;
      }

      .btn-messsage {
        color: #000;
        background-color: #fff;
        border: 1px solid #888787;
      }
    </style>
  </head>
  <body>
    <main>
      <header>
        <h1>⚾️ 야구 일정표</h1>
      </header>
      <div class="container">
        <table id="schedule-table">
          <thead>
            <tr>
              <th class="font-size-sm text-center">날짜</th>
              <th class="font-size-sm text-center">시간</th>
              <th class="font-size-sm">구장</th>
              <th class="font-size-sm text-center">원정팀</th>
              <th class="font-size-sm"></th>
              <th class="font-size-sm text-center">홈팀</th>
              <th class="font-size-sm">구분</th>
              <th class="font-size-sm">방송사</th>
              <th class="font-size-sm text-center">중계/기록</th>
            </tr>
          </thead>
        </table>
      </div>
    </main>

    <script type="module">
      import {
        createEl,
        createTeamEl,
        isToday,
        getFormattedDate,
        getFormattedTime,
        getFormattedScore,
        getBroadcastLabel,
      } from './baseballUtils.js';

      const scheduleTable = document.getElementById('schedule-table');

      async function fetchSchedule() {
        const res = await fetch('./schedule.json');
        if (!res.ok) throw new Error('Failed to fetch schedule.json');

        const { schedule } = await res.json();
        return schedule;
      }

      async function loadSchedule() {
        const schedule = await fetchSchedule();

        Object.entries(schedule).forEach(([date, games]) => {
          const formattedDate = getFormattedDate(date);
          const tbody = createEl({
            tag: 'tbody',
            className: isToday(date) ? 'today-game' : '',
          });
          tbody.dataset.date = formattedDate;

          games.forEach((game, index) => {
            const tr = document.createElement('tr');
            const { awayTeamName, awayTeamImageUrl, homeTeamName, homeTeamImageUrl, fieldName, gameDetailType, op } =
              game;

            // 날짜
            if (index === 0) {
              const dateTd = createEl({ tag: 'td', className: `font-size-lg text-center `, inner: formattedDate });
              dateTd.rowSpan = games.length;
              tr.appendChild(dateTd);
            }

            // 시간
            tr.appendChild(createEl({ tag: 'td', className: 'text-center', inner: getFormattedTime(game) }));
            // 구장
            tr.appendChild(createEl({ tag: 'td', text: fieldName }));
            // 완정팀
            tr.appendChild(createTeamEl(awayTeamName, awayTeamImageUrl, false));
            // 스코어
            tr.appendChild(createEl({ tag: 'td', className: 'game-score', inner: getFormattedScore(game) }));
            // 홈팀
            tr.appendChild(createTeamEl(homeTeamName, homeTeamImageUrl, true));
            // 구분
            tr.appendChild(createEl({ tag: 'td', text: gameDetailType.name || '-' }));
            // 방송사
            tr.appendChild(createEl({ tag: 'td', text: op?.broadcast || '' }));
            // 중계기록
            const td = createEl({ tag: 'td', className: 'text-center' });
            td.appendChild(getBroadcastLabel(game));
            tr.appendChild(td);

            tbody.appendChild(tr);
          });

          scheduleTable.appendChild(tbody);
        });
      }

      loadSchedule();
    </script>
  </body>
</html>
